/*!
 * backbone.maps
 * A Backbone JS extension for interacting with javascript maps APIs
 * Copyright (c) 2015 Radoslav Salov
 * Distributed under MIT license
 * Copyright for portions of the project are held by:
 * Edan Schwartz (c) 2012-2015 ( https://github.com/eschwartz/backbone.googlemaps )
 */
!function(a,b){if("function"==typeof define&&define.amd)define(["backbone.googlemaps","d3"],b);else if("object"==typeof exports){var c=require("backbone.googlemaps"),d=require("d3");module.exports=b(c,d)}else b(a.Backbone.GoogleMaps,a.d3)}(this,function(a,b){"use strict";return a.MapViewD3=a.MapView.extend({constructor:function(c){a.MapView.prototype.constructor.apply(this,arguments);var d=this;this.gBounds=new google.maps.LatLngBounds,this.gOverlay=new google.maps.OverlayView,this.gLayer=null,this.gOverlay.onAdd=function(){d.gLayer=b.select(this.getPanes().overlayMouseTarget).append("div").attr("class","stations")},this.markers={}},addMarker:function(b){b=b instanceof a.Location?b:new a.Location(b),this.markers[b.cid]=b},onRender:function(){a.MapView.prototype.onRender&&a.MapView.prototype.onRender.apply(this,arguments);var c=this;this.gOverlay.draw=function(){function a(a){return a=e.fromLatLngToDivPixel(a.value.getLatLng()),b.select(this).style("left",a.x-f+"px").style("top",a.y-f+"px")}function d(){var a=10==b.select(this).attr("r")?5:10;b.select(this).transition().duration(100).attr("r",a)}var e=this.getProjection(),f=10,g=c.gLayer.selectAll("svg").data(b.entries(c.markers)).each(a).enter().append("svg:svg").each(a).attr("class","marker");g.append("svg:circle").attr("r",5).attr("cx",f).attr("cy",f).on("click",d)},this.gOverlay.setMap(this.map)}}),a});